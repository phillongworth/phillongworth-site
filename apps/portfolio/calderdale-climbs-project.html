<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Calderdale 50 Climbs - Cycling Log</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 500px;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
        }
        #climbs-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 2rem;
        }
        #climbs-table th, #climbs-table td {
            border: 1px solid #e2e8f0;
            padding: 0.5rem 0.75rem;
            text-align: left;
        }
        #climbs-table th {
            background-color: #f8fafc;
            font-weight: 600;
        }
        #climbs-table td:nth-child(3),
        #climbs-table td:nth-child(4),
        #climbs-table td:nth-child(5) {
            text-align: right;
        }
        #climbs-table tbody tr:hover {
            background-color: #f8fafc;
        }
        #climbs-table a {
            color: #2563eb;
            text-decoration: none;
        }
        #climbs-table a:hover {
            text-decoration: underline;
        }
        .section-heading {
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <main class="container">
        <section class="project-header header-rose">
            <h1>The Calderdale 50 Climbs</h1>
            <p>50 hill climbs across Calderdale, plus a few extras</p>
        </section>

        <section class="project-details">
            <div id="map"></div>
            <h2 class="section-heading">The 50 Climbs</h2>
            <table id="climbs-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Area</th>
                        <th>Distance (mi)</th>
                        <th>Ascent (ft)</th>
                        <th>Gradient (%)</th>
                        <th>Route</th>
                    </tr>
                </thead>
                <tbody id="climbs-body"></tbody>
            </table>
            <h2 id="others-heading" class="section-heading" style="display:none;">The Others</h2>
            <table id="others-table" style="display:none;">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Link</th>
                    </tr>
                </thead>
                <tbody id="others-body"></tbody>
            </table>
            <a href="https://calderdale50.wordpress.com/50-climbs/" class="button" target="_blank">
                <span>The Calderdale 50 website</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
            </a>
            <a href="index.html" class="back-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
                Back to Projects
            </a>
        </section>
    </main>

    <footer>
        <div class="footer-content">

            <nav>
                <a href="#">---</a>
                <a href="#">---</a>

            </nav>
            <p>This page was last updated on: <span id="last-updated"></span></p>

    <script src="script.js"></script>

        </div>
    </footer>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([53.72, -1.93], 12);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        fetch('data/generated/calderdale50.json')
            .then(function(r) { return r.json(); })
            .then(function(data) {
                var bounds = L.latLngBounds();
                var mainBody = document.getElementById('climbs-body');
                var othersBody = document.getElementById('others-body');
                var othersCount = 0;

                var colors = ['#e6194b', '#3cb44b', '#4363d8', '#f58231', '#911eb4',
                              '#42d4f4', '#f032e6', '#bfef45', '#fabed4', '#469990'];

                data.climbs.forEach(function(climb, index) {
                    var popupHtml = '<b>' + climb.name + '</b>';
                    if (climb.area) popupHtml += '<br>' + climb.area;
                    if (climb.distance_miles) popupHtml += '<br>Distance: ' + climb.distance_miles + ' mi';
                    if (climb.ascent_feet) popupHtml += '<br>Ascent: ' + climb.ascent_feet + ' ft';
                    if (climb.average_gradient_pct) popupHtml += '<br>Gradient: ' + climb.average_gradient_pct + '%';
                    if (climb.plotaroute_url) popupHtml += '<br><a href="' + climb.plotaroute_url + '" target="_blank">Route map</a>';
                    if (climb.url) popupHtml += '<br><a href="' + climb.url + '" target="_blank">Details</a>';

                    // Draw track polyline if available (skip climbs without tracks)
                    if (climb.track && climb.track.length > 1) {
                        var color = colors[index % colors.length];
                        var polyline = L.polyline(climb.track, {
                            color: color,
                            opacity: 0.8,
                            weight: 3
                        }).addTo(map).bindPopup(popupHtml);
                        bounds.extend(polyline.getBounds());
                    }

                    if (climb.category === 'main') {
                        // Main 50 table
                        var row = mainBody.insertRow();
                        row.insertCell(0).textContent = climb.number;
                        row.insertCell(1).textContent = climb.name;
                        row.insertCell(2).textContent = climb.area || '';
                        row.insertCell(3).textContent = climb.distance_miles || '';
                        row.insertCell(4).textContent = climb.ascent_feet || '';
                        row.insertCell(5).textContent = climb.average_gradient_pct || '';

                        var linkCell = row.insertCell(6);
                        if (climb.plotaroute_url) {
                            var a = document.createElement('a');
                            a.href = climb.plotaroute_url;
                            a.target = '_blank';
                            a.textContent = 'View';
                            linkCell.appendChild(a);
                        }
                    } else {
                        // Others table
                        othersCount++;
                        var row = othersBody.insertRow();
                        row.insertCell(0).textContent = othersCount;
                        row.insertCell(1).textContent = climb.name;

                        var linkCell = row.insertCell(2);
                        if (climb.url) {
                            var a = document.createElement('a');
                            a.href = climb.url;
                            a.target = '_blank';
                            a.textContent = 'View';
                            linkCell.appendChild(a);
                        }
                    }
                });

                if (othersCount > 0) {
                    document.getElementById('others-heading').style.display = '';
                    document.getElementById('others-table').style.display = '';
                    document.getElementById('others-table').className = 'climbs-table';
                }

                if (bounds.isValid()) {
                    map.fitBounds(bounds, { padding: [20, 20] });
                }
            });
    </script>
</body>
</html>
