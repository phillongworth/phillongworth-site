<!DOCTYPE html>
<html>
<head>
    <title>1000m in 2025 GPX Tracks (OpenStreetMap)</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 600px;
        }
        #track-table, #summary-table {
            margin-top: 20px;
            width: 60%;
            border-collapse: collapse;
        }
        #track-table th, #track-table td, #summary-table th, #summary-table td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        #track-table th, #summary-table th {
            background-color: #f2f2f2;
            text-align: left;
        }
        #track-table td:nth-child(2), #track-table td:nth-child(3), #track-table td:nth-child(4),
        #summary-table td:nth-child(2) {
            text-align: right;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <table id="track-table">
        <thead>
            <tr>
                <th>Track Number</th>
                <th>Date</th>
                <th>Distance (miles)</th>
                <th>Elevation Gain (feet)</th>
            </tr>
        </thead>
        <tbody id="track-table-body">
        </tbody>
    </table>
    <table id="summary-table">
        <thead>
            <tr>
                <th>Summary</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Number of Tracks</td>
                <td id="total-tracks">0</td>
            </tr>
            <tr>
                <td>Total Distance (miles)</td>
                <td id="total-distance">0</td>
            </tr>
            <tr>
                <td>Total Elevation Gain (feet)</td>
                <td id="total-elevation">0</td>
            </tr>
        </tbody>
    </table>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([53.615, -1.910], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var colors = ['red', 'blue', 'green', 'black', 'yellow'];

        function formatDate(dateStr) {
            if (!dateStr) return 'N/A';
            var d = new Date(dateStr + 'T00:00:00');
            return d.toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });
        }

        fetch('data/tracks.json')
            .then(function(r) { return r.json(); })
            .then(function(data) {
                var bounds = L.latLngBounds();

                data.tracks.forEach(function(track, index) {
                    var latlngs = track.coordinates.map(function(c) { return [c[0], c[1]]; });
                    var color = colors[index % colors.length];

                    var polyline = L.polyline(latlngs, {
                        color: color,
                        opacity: 0.75,
                        weight: 3,
                        lineCap: 'round'
                    }).addTo(map);

                    polyline.bindPopup(
                        '<b>Track ' + track.id + '</b><br>' +
                        'Date: ' + formatDate(track.date) + '<br>' +
                        'Distance: ' + track.distance_miles.toFixed(2) + ' miles<br>' +
                        'Elevation Gain: ' + track.elevation_feet.toFixed(0) + ' feet'
                    );

                    bounds.extend(latlngs);
                });

                map.fitBounds(bounds);

                // Populate summary
                document.getElementById('total-tracks').textContent = data.summary.total_tracks;
                document.getElementById('total-distance').textContent = data.summary.total_distance_miles.toFixed(2);
                document.getElementById('total-elevation').textContent = data.summary.total_elevation_feet.toFixed(0);

                // Populate track table
                var tableBody = document.getElementById('track-table-body');
                data.tracks.forEach(function(track) {
                    var row = tableBody.insertRow();
                    row.insertCell(0).textContent = track.id;
                    row.insertCell(1).textContent = formatDate(track.date);
                    row.insertCell(2).textContent = track.distance_miles.toFixed(2);
                    row.insertCell(3).textContent = track.elevation_feet.toFixed(0);
                });
            });
    </script>
</body>
</html>
